jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Stroke",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target"}},plugins:{},svgPath:null,hideButtonTexts:null},function(e,t,n,r){"use strict";r.fn.trumbowyg=function(e,t){var n="trumbowyg";if(e===Object(e)||!e)return this.each(function(){r(this).data(n)||r(this).data(n,new a(this,e))});if(1===this.length)try{var o=r(this).data(n);switch(e){case"execCmd":return o.execCmd(t.cmd,t.param,t.forceCss);case"openModal":return o.openModal(t.title,t.content);case"closeModal":return o.closeModal();case"openModalInsert":return o.openModalInsert(t.title,t.fields,t.callback);case"saveRange":return o.saveRange();case"getRange":return o.range;case"getRangeText":return o.getRangeText();case"restoreRange":return o.restoreRange();case"enable":return o.toggleDisable(!1);case"disable":return o.toggleDisable(!0);case"destroy":return o.destroy();case"empty":return o.empty();case"html":return o.html(t)}}catch(i){}return!1};var a=function(e,a){var o=this,i="trumbowyg-icons";o.doc=e.ownerDocument||n,o.$ta=r(e),o.$c=r(e),a=a||{},null!=a.lang||null!=r.trumbowyg.langs[a.lang]?o.lang=r.extend(!0,{},r.trumbowyg.langs.en,r.trumbowyg.langs[a.lang]):o.lang=r.trumbowyg.langs.en,o.hideButtonTexts=null!=r.trumbowyg.hideButtonTexts?r.trumbowyg.hideButtonTexts:a.hideButtonTexts;var s=null!=r.trumbowyg.svgPath?r.trumbowyg.svgPath:a.svgPath;if(o.hasSvg=s!==!1,o.svgPath=o.doc.querySelector("base")?t.location.href.split("#")[0]:"",0===r("#"+i,o.doc).length&&s!==!1){if(null==s)try{throw new Error}catch(l){var d=l.stack.split("\n");for(var u in d)if(d[u].match(/http[s]?:\/\//)){s=d[Number(u)].match(/((http[s]?:\/\/.+\/)([^\/]+\.js))(\?.*)?:/)[1].split("/"),s.pop(),s=s.join("/")+"/ui/icons.svg";break}}var c=o.doc.createElement("div");c.id=i,o.doc.body.insertBefore(c,o.doc.body.childNodes[0]),r.ajax({async:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"xml",url:s,data:null,beforeSend:null,complete:null,success:function(e){c.innerHTML=(new XMLSerializer).serializeToString(e.documentElement)}})}var g=o.lang.header,p=function(){return(t.chrome||t.Intl&&Intl.v8BreakIterator)&&"CSS"in t};o.btnsDef={viewHTML:{fn:"toggle"},undo:{isSupported:p,key:"Z"},redo:{isSupported:p,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:g+" 1"},h2:{fn:"formatBlock",title:g+" 2"},h3:{fn:"formatBlock",title:g+" 3"},h4:{fn:"formatBlock",title:g+" 4"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{"class":"trumbowyg-not-disable"},close:{fn:"destroy","class":"trumbowyg-not-disable"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}},o.o=r.extend(!0,{},{lang:"en",useComposition:!0,fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,prefix:"trumbowyg-",semantic:!0,resetCss:!1,removeformatPasted:!1,tagsToRemove:[],btnsGrps:{design:["bold","italic","underline","strikethrough"],semantic:["strong","em","del"],justify:["justifyLeft","justifyCenter","justifyRight","justifyFull"],lists:["unorderedList","orderedList"]},btns:[["viewHTML"],["undo","redo"],["formatting"],"btnGrp-semantic",["superscript","subscript"],["link"],["insertImage"],"btnGrp-justify","btnGrp-lists",["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],imgDblClickHandler:function(){var e=r(this),t=e.attr("src"),n="(Base64)";return 0===t.indexOf("data:image")&&(t=n),o.openModalInsert(o.lang.insertImage,{url:{label:"URL",value:t,required:!0},alt:{label:o.lang.description,value:e.attr("alt")}},function(t){return t.src!==n&&e.attr({src:t.src}),e.attr({alt:t.alt}),!0}),!1},plugins:{}},a),o.disabled=o.o.disabled||"TEXTAREA"===e.nodeName&&e.disabled,a.btns?o.o.btns=a.btns:o.o.semantic||(o.o.btns[4]="btnGrp-design"),r.each(o.o.btnsDef,function(e,t){o.addBtnDef(e,t)}),o.eventNamespace="trumbowyg-event",o.keys=[],o.tagToButton={},o.tagHandlers=[],o.pasteHandlers=[].concat(o.o.pasteHandlers),o.init()};a.prototype={init:function(){var e=this;e.height=e.$ta.height(),e.initPlugins();try{e.doc.execCommand("enableObjectResizing",!1,!1),e.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(t){}e.buildEditor(),e.buildBtnPane(),e.fixedBtnPaneEvents(),e.buildOverlay(),setTimeout(function(){e.disabled&&e.toggleDisable(!0),e.$c.trigger("tbwinit")})},addBtnDef:function(e,t){this.btnsDef[e]=t},buildEditor:function(){var n=this,a=n.o.prefix,o="";n.$box=r("<div/>",{"class":a+"box "+a+"editor-visible "+a+n.o.lang+" trumbowyg"}),n.isTextarea=n.$ta.is("textarea"),n.isTextarea?(o=n.$ta.val(),n.$ed=r("<div/>"),n.$box.insertAfter(n.$ta).append(n.$ed,n.$ta)):(n.$ed=n.$ta,o=n.$ed.html(),n.$ta=r("<textarea/>",{name:n.$ta.attr("id"),height:n.height}).val(o),n.$box.insertAfter(n.$ed).append(n.$ta,n.$ed),n.syncCode()),n.$ta.addClass(a+"textarea").attr("tabindex",-1),n.$ed.addClass(a+"editor").attr({contenteditable:!0,dir:n.lang._dir||"ltr"}).html(o),n.o.tabindex&&n.$ed.attr("tabindex",n.o.tabindex),n.$c.is("[placeholder]")&&n.$ed.attr("placeholder",n.$c.attr("placeholder")),n.o.resetCss&&n.$ed.addClass(a+"reset-css"),n.o.autogrow||n.$ta.add(n.$ed).css({height:n.height}),n.semanticCode();var i,s=!1,l=!1,d=!!e.userAgent.match(/Android/i);n.$ed.on("dblclick","img",n.o.imgDblClickHandler).on("keydown",function(e){if(l=n.o.useComposition&&!d&&229===e.which,e.ctrlKey){s=!0;var t=n.keys[String.fromCharCode(e.which).toUpperCase()];try{return n.execCmd(t.fn,t.param),!1}catch(r){}}}).on("input",function(e){n.semanticCode(!1,!0),n.$c.trigger("tbwchange")}).on("keyup",function(e){var t=e.which;!d||t&&229!==t||(t=this.textContent.charCodeAt(this.textContent.length-1)),t>=37&&t<=40||(!e.ctrlKey||89!==t&&90!==t?s||17===t||l?"undefined"==typeof e.which&&l&&n.semanticCode(!1,!1,!0):(n.semanticCode(!1,13===t),n.$c.trigger("tbwchange")):n.$c.trigger("tbwchange"),setTimeout(function(){s=!1},200))}).on("mouseup keydown keyup",function(){clearTimeout(i),i=setTimeout(function(){n.updateButtonPaneStatus()},50)}).on("focus blur",function(e){n.$c.trigger("tbw"+e.type),"blur"===e.type&&r("."+a+"active-button",n.$btnPane).removeClass(a+"active-button "+a+"active")}).on("cut",function(){setTimeout(function(){n.semanticCode(!1,!0),n.$c.trigger("tbwchange")},0)}).on("paste",function(e){if(n.o.removeformatPasted){e.preventDefault();try{var a=t.clipboardData.getData("Text");try{n.doc.selection.createRange().pasteHTML(a)}catch(o){n.doc.getSelection().getRangeAt(0).insertNode(n.doc.createTextNode(a))}}catch(i){n.execCmd("insertText",(e.originalEvent||e).clipboardData.getData("text/plain"))}}r.each(n.pasteHandlers,function(t,n){n(e)}),setTimeout(function(){n.semanticCode(!1,!0),n.$c.trigger("tbwpaste",e)},0)}),n.$ta.on("keyup paste",function(){n.$c.trigger("tbwchange")}),n.$box.on("keydown",function(e){if(27===e.which&&1===r("."+a+"modal-box",n.$box).length)return n.closeModal(),!1})},buildBtnPane:function(){var e=this,t=e.o.prefix,n=e.$btnPane=r("<div/>",{"class":t+"button-pane"});r.each(e.o.btns,function(a,o){try{var i=o.split("btnGrp-");null!=i[1]&&(o=e.o.btnsGrps[i[1]])}catch(s){}r.isArray(o)||(o=[o]);var l=r("<div/>",{"class":t+"button-group "+(o.indexOf("fullscreen")>=0?t+"right":"")});r.each(o,function(t,n){try{var r;e.isSupportedBtn(n)&&(r=e.buildBtn(n)),l.append(r)}catch(a){}}),n.append(l)}),e.$box.prepend(n)},buildBtn:function(e){var t=this,n=t.o.prefix,a=t.btnsDef[e],o=a.dropdown,i=null==a.hasIcon||a.hasIcon,s=t.lang[e]||e,l=r("<button/>",{type:"button","class":n+e+"-button "+(a["class"]||"")+(i?"":" "+n+"textual-button"),html:t.hasSvg&&i?'<svg><use xlink:href="'+t.svgPath+"#"+n+(a.ico||e).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>':t.hideButtonTexts?"":a.text||a.title||t.lang[e]||e,title:(a.title||a.text||s)+(a.key?" (Ctrl + "+a.key+")":""),tabindex:-1,mousedown:function(){return o&&!r("."+e+"-"+n+"dropdown",t.$box).is(":hidden")||r("body",t.doc).trigger("mousedown"),!(t.$btnPane.hasClass(n+"disable")&&!r(this).hasClass(n+"active")&&!r(this).hasClass(n+"not-disable"))&&(t.execCmd(!!o&&"dropdown"||a.fn||e,a.param||e,a.forceCss||!1),!1)}});if(o){l.addClass(n+"open-dropdown");var d=n+"dropdown",u=r("<div/>",{"class":d+"-"+e+" "+d+" "+n+"fixed-top","data-dropdown":e});r.each(o,function(e,n){t.btnsDef[n]&&t.isSupportedBtn(n)&&u.append(t.buildSubBtn(n))}),t.$box.append(u.hide())}else a.key&&(t.keys[a.key]={fn:a.fn||e,param:a.param||e});return o||(t.tagToButton[(a.tag||e).toLowerCase()]=e),l},buildSubBtn:function(e){var t=this,n=t.o.prefix,a=t.btnsDef[e],o=null==a.hasIcon||a.hasIcon;return a.key&&(t.keys[a.key]={fn:a.fn||e,param:a.param||e}),t.tagToButton[(a.tag||e).toLowerCase()]=e,r("<button/>",{type:"button","class":n+e+"-dropdown-button"+(a.ico?" "+n+a.ico+"-button":""),html:t.hasSvg&&o?'<svg><use xlink:href="'+t.svgPath+"#"+n+(a.ico||e).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>'+(a.text||a.title||t.lang[e]||e):a.text||a.title||t.lang[e]||e,title:a.key?" (Ctrl + "+a.key+")":null,style:a.style||null,mousedown:function(){return r("body",t.doc).trigger("mousedown"),t.execCmd(a.fn||e,a.param||e,a.forceCss||!1),!1}})},isSupportedBtn:function(e){try{return this.btnsDef[e].isSupported()}catch(t){}return!0},buildOverlay:function(){var e=this;return e.$overlay=r("<div/>",{"class":e.o.prefix+"overlay"}).css({top:e.$btnPane.outerHeight(),height:e.$ed.outerHeight()+1+"px"}).appendTo(e.$box),e.$overlay},showOverlay:function(){var e=this;r(t).trigger("scroll"),e.$overlay.fadeIn(200),e.$box.addClass(e.o.prefix+"box-blur")},hideOverlay:function(){var e=this;e.$overlay.fadeOut(50),e.$box.removeClass(e.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var e=this,n=e.o.fixedFullWidth,a=e.$box;e.o.fixedBtnPane&&(e.isFixed=!1,r(t).on("scroll."+e.eventNamespace+" resize."+e.eventNamespace,function(){if(a){e.syncCode();var o=r(t).scrollTop(),i=a.offset().top+1,s=e.$btnPane,l=s.outerHeight()-2;o-i>0&&o-i-e.height<0?(e.isFixed||(e.isFixed=!0,s.css({position:"fixed",top:0,left:n?"0":"auto",zIndex:7}),r([e.$ta,e.$ed]).css({marginTop:s.height()})),s.css({width:n?"100%":a.width()-1+"px"}),r("."+e.o.prefix+"fixed-top",a).css({position:n?"fixed":"absolute",top:n?l:l+(o-i)+"px",zIndex:15})):e.isFixed&&(e.isFixed=!1,s.removeAttr("style"),r([e.$ta,e.$ed]).css({marginTop:0}),r("."+e.o.prefix+"fixed-top",a).css({position:"absolute",top:l}))}}))},toggleDisable:function(e){var t=this,n=t.o.prefix;t.disabled=e,e?t.$ta.attr("disabled",!0):t.$ta.removeAttr("disabled"),t.$box.toggleClass(n+"disabled",e),t.$ed.attr("contenteditable",!e)},destroy:function(){var e=this,n=e.o.prefix,a=e.height;e.isTextarea?e.$box.after(e.$ta.css({height:a}).val(e.html()).removeClass(n+"textarea").show()):e.$box.after(e.$ed.css({height:a}).removeClass(n+"editor").removeAttr("contenteditable").html(e.html()).show()),e.$ed.off("dblclick","img"),e.destroyPlugins(),e.$box.remove(),e.$c.removeData("trumbowyg"),r("body").removeClass(n+"body-fullscreen"),e.$c.trigger("tbwclose"),r(t).off("scroll."+e.eventNamespace+" resize."+e.eventNamespace)},empty:function(){this.$ta.val(""),this.syncCode(!0)},toggle:function(){var e=this,t=e.o.prefix;e.semanticCode(!1,!0),setTimeout(function(){e.doc.activeElement.blur(),e.$box.toggleClass(t+"editor-hidden "+t+"editor-visible"),e.$btnPane.toggleClass(t+"disable"),r("."+t+"viewHTML-button",e.$btnPane).toggleClass(t+"active"),e.$box.hasClass(t+"editor-visible")?e.$ta.attr("tabindex",-1):e.$ta.removeAttr("tabindex")},0)},dropdown:function(e){var n=this,a=n.doc,o=n.o.prefix,i=r("[data-dropdown="+e+"]",n.$box),s=r("."+o+e+"-button",n.$btnPane),l=i.is(":hidden");if(r("body",a).trigger("mousedown"),l){var d=s.offset().left;s.addClass(o+"active"),i.css({position:"absolute",top:s.offset().top-n.$btnPane.offset().top+s.outerHeight(),left:n.o.fixedFullWidth&&n.isFixed?d+"px":d-n.$btnPane.offset().left+"px"}).show(),r(t).trigger("scroll"),r("body",a).on("mousedown."+n.eventNamespace,function(e){i.is(e.target)||(r("."+o+"dropdown",a).hide(),r("."+o+"active",a).removeClass(o+"active"),r("body",a).off("mousedown."+n.eventNamespace))})}},html:function(e){var t=this;return null!=e?(t.$ta.val(e),t.syncCode(!0),t):t.$ta.val()},syncTextarea:function(){var e=this;e.$ta.val(e.$ed.text().trim().length>0||e.$ed.find("hr,img,embed,iframe,input").length>0?e.$ed.html():"")},syncCode:function(e){var t=this;!e&&t.$ed.is(":visible")?t.syncTextarea():t.$ed.html(t.$ta.val()),t.o.autogrow&&(t.height=t.$ed.height(),t.height!==t.$ta.css("height")&&(t.$ta.css({height:t.height}),t.$c.trigger("tbwresize")))},semanticCode:function(e,t,n){var a=this;if(a.saveRange(),a.syncCode(e),r(a.o.tagsToRemove.join(","),a.$ed).remove(),a.o.semantic){if(a.semanticTag("b","strong"),a.semanticTag("i","em"),t){var o=a.o.inlineElementsSelector,i=":not("+o+")";a.$ed.contents().filter(function(){return 3===this.nodeType&&this.nodeValue.trim().length>0}).wrap("<span data-tbw/>");var s=function(e){if(0!==e.length){var t=e.nextUntil(i).addBack().wrapAll("<p/>").parent(),n=t.nextAll(o).first();t.next("br").remove(),s(n)}};s(a.$ed.children(o).first()),a.semanticTag("div","p",!0),a.$ed.find("p").filter(function(){return(!a.range||this!==a.range.startContainer)&&(0===r(this).text().trim().length&&0===r(this).children().not("br,span").length)}).contents().unwrap(),r("[data-tbw]",a.$ed).contents().unwrap(),a.$ed.find("p:empty").remove()}n||a.restoreRange(),a.syncTextarea()}},semanticTag:function(e,t,n){r(e,this.$ed).each(function(){var e=r(this);e.wrap("<"+t+"/>"),n&&r.each(e.prop("attributes"),function(){e.parent().attr(this.name,this.value)}),e.contents().unwrap()})},createLink:function(){for(var e,t,n,a=this,o=a.doc.getSelection(),i=o.focusNode;["A","DIV"].indexOf(i.nodeName)<0;)i=i.parentNode;if(i&&"A"===i.nodeName){var s=r(i);e=s.attr("href"),t=s.attr("title"),n=s.attr("target");var l=a.doc.createRange();l.selectNode(i),o.addRange(l)}a.saveRange(),a.openModalInsert(a.lang.createLink,{url:{label:"URL",required:!0,value:e},title:{label:a.lang.title,value:t},text:{label:a.lang.text,value:a.getRangeText()},target:{label:a.lang.target,value:n}},function(e){var t=r(['<a href="',e.url,'">',e.text,"</a>"].join(""));return e.title.length>0&&t.attr("title",e.title),e.target.length>0&&t.attr("target",e.target),a.range.deleteContents(),a.range.insertNode(t[0]),!0})},unlink:function(){var e=this,t=e.doc.getSelection(),n=t.focusNode;if(t.isCollapsed){for(;["A","DIV"].indexOf(n.nodeName)<0;)n=n.parentNode;if(n&&"A"===n.nodeName){var r=e.doc.createRange();r.selectNode(n),t.addRange(r)}}e.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var e=this;e.saveRange(),e.openModalInsert(e.lang.insertImage,{url:{label:"URL",required:!0},alt:{label:e.lang.description,value:e.getRangeText()}},function(t){return e.execCmd("insertImage",t.url),r('img[src="'+t.url+'"]:not([alt])',e.$box).attr("alt",t.alt),!0})},fullscreen:function(){var e,n=this,a=n.o.prefix,o=a+"fullscreen";n.$box.toggleClass(o),e=n.$box.hasClass(o),r("body").toggleClass(a+"body-fullscreen",e),r(t).trigger("scroll"),n.$c.trigger("tbw"+(e?"open":"close")+"fullscreen")},execCmd:function(t,n,r,a){var o=this;a=!!a||"","dropdown"!==t&&o.$ed.focus();try{o.doc.execCommand("styleWithCSS",!1,r||!1)}catch(i){}try{o[t+a](n)}catch(i){try{t(n)}catch(s){"insertHorizontalRule"===t?n=void 0:"formatBlock"!==t||e.userAgent.indexOf("MSIE")===-1&&e.appVersion.indexOf("Trident/")===-1||(n="<"+n+">"),o.doc.execCommand(t,!1,n),o.syncCode(),o.semanticCode(!1,!0)}"dropdown"!==t&&(o.updateButtonPaneStatus(),o.$c.trigger("tbwchange"))}},openModal:function(e,n){var a=this,o=a.o.prefix;if(r("."+o+"modal-box",a.$box).length>0)return!1;a.saveRange(),a.showOverlay(),a.$btnPane.addClass(o+"disable");var i=r("<div/>",{"class":o+"modal "+o+"fixed-top"}).css({top:a.$btnPane.height()}).appendTo(a.$box);a.$overlay.one("click",function(){return i.trigger("tbwcancel"),!1});var s=r("<form/>",{action:"",html:n}).on("submit",function(){return i.trigger("tbwconfirm"),!1}).on("reset",function(){return i.trigger("tbwcancel"),!1}),l=r("<div/>",{"class":o+"modal-box",html:s}).css({top:"-"+a.$btnPane.outerHeight()+"px",opacity:0}).appendTo(i).animate({top:0,opacity:1},100);return r("<span/>",{text:e,"class":o+"modal-title"}).prependTo(l),i.height(l.outerHeight()+10),r("input:first",l).focus(),a.buildModalBtn("submit",l),a.buildModalBtn("reset",l),r(t).trigger("scroll"),i},buildModalBtn:function(e,t){var n=this,a=n.o.prefix;return r("<button/>",{"class":a+"modal-button "+a+"modal-"+e,type:e,text:n.lang[e]||e}).appendTo(r("form",t))},closeModal:function(){var e=this,t=e.o.prefix;e.$btnPane.removeClass(t+"disable"),e.$overlay.off();var n=r("."+t+"modal-box",e.$box);n.animate({top:"-"+n.height()},100,function(){n.parent().remove(),e.hideOverlay()}),e.restoreRange()},openModalInsert:function(e,t,n){var a=this,o=a.o.prefix,i=a.lang,s="",l="tbwconfirm";return r.each(t,function(e,t){var n=t.label,r=t.name||e,a=t.attributes||{},l=Object.keys(a).map(function(e){return e+'="'+a[e]+'"'}).join(" ");s+='<label><input type="'+(t.type||"text")+'" name="'+r+'" value="'+(t.value||"").replace(/"/g,"&quot;")+'"'+l+'><span class="'+o+'input-infos"><span>'+(n?i[n]?i[n]:n:i[e]?i[e]:e)+"</span></span></label>"}),a.openModal(e,s).on(l,function(){var e=r("form",r(this)),o=!0,i={};r.each(t,function(t,n){var s=r('input[name="'+t+'"]',e),l=s.attr("type");"checkbox"===l.toLowerCase()?i[t]=s.is(":checked"):i[t]=r.trim(s.val()),n.required&&""===i[t]?(o=!1,a.addErrorOnModalField(s,a.lang.required)):n.pattern&&!n.pattern.test(i[t])&&(o=!1,a.addErrorOnModalField(s,n.patternError))}),o&&(a.restoreRange(),n(i,t)&&(a.syncCode(),a.$c.trigger("tbwchange"),a.closeModal(),r(this).off(l)))}).one("tbwcancel",function(){r(this).off(l),a.closeModal()})},addErrorOnModalField:function(e,t){var n=this.o.prefix,a=e.parent();e.on("change keyup",function(){a.removeClass(n+"input-error")}),a.addClass(n+"input-error").find("input+span").append(r("<span/>",{"class":n+"msg-error",text:t}))},saveRange:function(){var e=this,t=e.doc.getSelection();if(e.range=null,t.rangeCount){var n,r=e.range=t.getRangeAt(0),a=e.doc.createRange();a.selectNodeContents(e.$ed[0]),a.setEnd(r.startContainer,r.startOffset),n=(a+"").length,e.metaRange={start:n,end:n+(r+"").length}}},restoreRange:function(){var e,t=this,n=t.metaRange,r=t.range,a=t.doc.getSelection();if(r){if(n&&n.start!==n.end){var o,i=0,s=[t.$ed[0]],l=!1,d=!1;for(e=t.doc.createRange();!d&&(o=s.pop());)if(3===o.nodeType){var u=i+o.length;!l&&n.start>=i&&n.start<=u&&(e.setStart(o,n.start-i),l=!0),l&&n.end>=i&&n.end<=u&&(e.setEnd(o,n.end-i),d=!0),i=u}else for(var c=o.childNodes,g=c.length;g>0;)g-=1,s.push(c[g])}a.removeAllRanges(),a.addRange(e||r)}},getRangeText:function(){return this.range+""},updateButtonPaneStatus:function(){var e=this,t=e.o.prefix,n=e.getTagsRecursive(e.doc.getSelection().focusNode),a=t+"active-button "+t+"active";r("."+t+"active-button",e.$btnPane).removeClass(a),r.each(n,function(n,o){var i=e.tagToButton[o.toLowerCase()],s=r("."+t+i+"-button",e.$btnPane);if(s.length>0)s.addClass(a);else try{s=r("."+t+"dropdown ."+t+i+"-dropdown-button",e.$box);var l=s.parent().data("dropdown");r("."+t+l+"-button",e.$box).addClass(a)}catch(d){}})},getTagsRecursive:function(e,t){var n=this;if(t=t||[],!e||!e.parentNode)return t;e=e.parentNode;var a=e.tagName;return"DIV"===a?t:("P"===a&&""!==e.style.textAlign&&t.push(e.style.textAlign),r.each(n.tagHandlers,function(r,a){t=t.concat(a(e,n))}),t.push(a),n.getTagsRecursive(e,t))},initPlugins:function(){var e=this;e.loadedPlugins=[],r.each(r.trumbowyg.plugins,function(t,n){n.shouldInit&&!n.shouldInit(e)||(n.init(e),n.tagHandler&&e.tagHandlers.push(n.tagHandler),e.loadedPlugins.push(n))})},destroyPlugins:function(){r.each(this.loadedPlugins,function(e,t){t.destroy&&t.destroy()})}}}(navigator,window,document,jQuery),function(e){"use strict";var t=function(){return"undefined"!=typeof FileReader},n=function(e){return/^data:image\/[a-z]?/i.test(e)};e.extend(!0,e.trumbowyg,{langs:{en:{base64:"Image as base64",file:"File",errFileReaderNotSupported:"FileReader is not supported by your browser.",errInvalidImage:"Invalid image file."},fr:{base64:"Image en base64",file:"Fichier"},cs:{base64:"Vložit obrázek",file:"Soubor"},zh_cn:{base64:"图片（Base64编码）",file:"文件"},nl:{errFileReaderNotSupported:"Uw browser ondersteunt deze functionaliteit niet.",errInvalidImage:"De gekozen afbeelding is ongeldig."}},plugins:{base64:{shouldInit:t,init:function(r){var a={isSupported:t,fn:function(){r.saveRange();var t,a=r.openModalInsert(r.lang.base64,{file:{type:"file",required:!0,attributes:{accept:"image/*"}},alt:{label:"description",value:r.getRangeText()}},function(o){var i=new FileReader;i.onloadend=function(t){n(t.target.result)?(r.execCmd("insertImage",i.result),e(['img[src="',i.result,'"]:not([alt])'].join(""),r.$box).attr("alt",o.alt),r.closeModal()):r.addErrorOnModalField(e("input[type=file]",a),r.lang.errInvalidImage)},i.readAsDataURL(t)});e("input[type=file]").on("change",function(e){t=e.target.files[0]})}};r.addBtnDef("base64",a)}}}})}(jQuery),function(e){"use strict";function t(e){for(var t="",n=e.length-1;n>=0;n-=1)t+=e.charAt(n);return t}function n(e){var t=e;return t=t.replace(/<[^> ]*/g,function(e){return e.toLowerCase()}),t=t.replace(/<[^>]*>/g,function(e){return e=e.replace(/ [^=]+=/g,function(e){return e.toLowerCase()})}),t=t.replace(/<[^>]*>/g,function(e){return e=e.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"')})}function r(e,r){var a,o,i,s="",l="";for(a=0;r.charAt(a)===e.charAt(a);a+=1)s+=r.charAt(a);for(var d=a;d>=0;d-=1){if("<"===e.charAt(d)){a=d,s=e.substring(0,a);break}if(">"===e.charAt(d))break}for(r=t(r),e=t(e),o=0;r.charAt(o)===e.charAt(o);o+=1)l+=r.charAt(o);for(var u=o;u>=0;u-=1){if(">"===e.charAt(u)){o=u,l=e.substring(0,o);break}if("<"===e.charAt(u))break}if(l=t(l),a===r.length-o)return!1;for(r=t(r),i=r.substring(a,r.length-o),i=n(i),i=i.replace(/<b(\s+|>)/g,"<strong$1"),i=i.replace(/<\/b(\s+|>)/g,"</strong$1"),i=i.replace(/<i(\s+|>)/g,"<em$1"),i=i.replace(/<\/i(\s+|>)/g,"</em$1"),i=i.replace(/<!(?:--[\s\S]*?--\s*)?>\s*/g,""),i=i.replace(/&nbsp;/gi," "),i=i.replace(/ <\//gi,"</");i.indexOf("  ")!==-1;){var c=i.split("  ");i=c.join(" ")}return i=i.replace(/^\s*|\s*$/g,""),i=i.replace(/<[^>]*>/g,function(e){return e=e.replace(/ ([^=]+)="[^"]*"/g,function(e,t){return["alt","href","src","title"].indexOf(t)!==-1?e:""})}),i=i.replace(/<\?xml[^>]*>/g,""),i=i.replace(/<[^ >]+:[^>]*>/g,""),i=i.replace(/<\/[^ >]+:[^>]*>/g,""),i=i.replace(/<(div|span|style|meta|link){1}.*?>/gi,""),r=s+i+l}e.extend(!0,e.trumbowyg,{plugins:{cleanPaste:{init:function(e){e.pasteHandlers.push(function(){try{var t=e.$ed.html();setTimeout(function(){var n=e.$ed.html();n=r(t,n),e.$ed.html(n)},0)}catch(n){}})}}}})}(jQuery),jQuery.trumbowyg.langs.fr={viewHTML:"Voir le HTML",undo:"Annuler",redo:"Refaire",formatting:"Format",p:"Paragraphe",blockquote:"Citation",code:"Code",header:"Titre",bold:"Gras",italic:"Italique",strikethrough:"Rayé",underline:"Souligné",strong:"Fort",em:"Emphase",del:"Supprimé",superscript:"Exposant",subscript:"Indice",unorderedList:"Liste à puces",orderedList:"Liste ordonnée",insertImage:"Insérer une image",insertVideo:"Insérer une video",link:"Lien",createLink:"Insérer un lien",unlink:"Supprimer le lien",justifyLeft:"Aligner à gauche",justifyCenter:"Centrer",justifyRight:"Aligner à droite",justifyFull:"Justifier",horizontalRule:"Insérer un séparateur horizontal",removeformat:"Supprimer formatage",fullscreen:"Plein écran",close:"Fermer",submit:"Valider",reset:"Annuler",required:"Obligatoire",description:"Description",title:"Titre",text:"Texte",target:"Cible"},function(e){"use strict";e.extend(!0,e.trumbowyg,{plugins:{pasteImage:{init:function(e){e.pasteHandlers.push(function(t){try{for(var n,r=(t.originalEvent||t).clipboardData.items,a=r.length-1;a>=0;a+=1)r[a].type.match(/^image\//)&&(n=new FileReader,n.onloadend=function(t){e.execCmd("insertImage",t.target.result,void 0,!0)},n.readAsDataURL(r[a].getAsFile()))}catch(o){}})}}}})}(jQuery),function(e){"use strict";function t(e,n){var r=n.shift(),a=n;if(null!==e){if(0===a.length)return e[r];if("object"==typeof e)return t(e[r],a)}return e}function n(){if(!e.trumbowyg&&!e.trumbowyg.addedXhrProgressEvent){var t=e.ajaxSettings.xhr;e.ajaxSetup({xhr:function(){var e=t(),n=this;return e&&"object"==typeof e.upload&&void 0!==n.progressUpload&&e.upload.addEventListener("progress",function(e){n.progressUpload(e)},!1),e}}),e.trumbowyg.addedXhrProgressEvent=!0}}var r={serverPath:"./src/plugins/upload/trumbowyg.upload.php",fileFieldName:"fileToUpload",data:[],headers:{},xhrFields:{},urlPropertyName:"file",statusPropertyName:"success",success:void 0,error:void 0};n(),e.extend(!0,e.trumbowyg,{langs:{en:{upload:"Upload",file:"File",uploadError:"Error"},sk:{upload:"Nahrať",file:"Súbor",uploadError:"Chyba"},fr:{upload:"Envoi",file:"Fichier",uploadError:"Erreur"},cs:{upload:"Nahrát obrázek",file:"Soubor",uploadError:"Chyba"},zh_cn:{upload:"上传",file:"文件",uploadError:"错误"},ru:{upload:"Загрузка",file:"Файл",uploadError:"Ошибка"}},plugins:{upload:{init:function(n){n.o.plugins.upload=e.extend(!0,{},r,n.o.plugins.upload||{});var a={fn:function(){n.saveRange();var r,a=n.o.prefix,o=n.openModalInsert(n.lang.upload,{file:{type:"file",required:!0,attributes:{accept:"image/*"}},alt:{label:"description",value:n.getRangeText()}},function(i){var s=new FormData;s.append(n.o.plugins.upload.fileFieldName,r),n.o.plugins.upload.data.map(function(e){s.append(e.name,e.value)}),0===e("."+a+"progress",o).length&&e("."+a+"modal-title",o).after(e("<div/>",{"class":a+"progress"}).append(e("<div/>",{"class":a+"progress-bar"}))),e.ajax({url:n.o.plugins.upload.serverPath,headers:n.o.plugins.upload.headers,xhrFields:n.o.plugins.upload.xhrFields,type:"POST",data:s,cache:!1,dataType:"json",processData:!1,contentType:!1,progressUpload:function(t){e("."+a+"progress-bar").stop().animate({width:Math.round(100*t.loaded/t.total)+"%"},200)},success:function(r){if(n.o.plugins.upload.success)n.o.plugins.upload.success(r,n,o,i);else if(t(r,n.o.plugins.upload.statusPropertyName.split("."))){var a=t(r,n.o.plugins.upload.urlPropertyName.split("."));n.execCmd("insertImage",a),e('img[src="'+a+'"]:not([alt])',n.$box).attr("alt",i.alt),setTimeout(function(){n.closeModal()},250),n.$c.trigger("tbwuploadsuccess",[n,r,a])}else n.addErrorOnModalField(e("input[type=file]",o),n.lang[r.message]),n.$c.trigger("tbwuploaderror",[n,r])},error:n.o.plugins.upload.error||function(){n.addErrorOnModalField(e("input[type=file]",o),n.lang.uploadError),n.$c.trigger("tbwuploaderror",[n])}})});e("input[type=file]").on("change",function(e){try{r=e.target.files[0]}catch(t){r=e.target.value}})}};n.addBtnDef("upload",a)}}}})}(jQuery),function(e){e.trumbowyg.svgPath=APP.asset_path+"/vendor/pilot/img/trumbowyg.svg",$textarea=e(".form-group textarea.wysywig"),$textarea.trumbowyg({btnsDef:{image:{dropdown:["insertImage","upload"],ico:"insertImage"}},btns:[["viewHTML"],["formatting"],"btnGrp-semantic",["superscript","subscript"],["link"],["image"],"btnGrp-justify","btnGrp-lists",["horizontalRule"],["removeformat"],["fullscreen"]],lang:"fr",plugins:{upload:{serverPath:APP.upload_url,fileFieldName:"image",data:[{name:"file_src",value:"wysywig"}],headers:{"X-CSRF-TOKEN":APP.csrf_token},urlPropertyName:"data.link"}}})}(jQuery);